<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Contents">

	<typeAlias alias="dpCatAdmin" type="com.omp.admin.contents.category.model.DpCatAdmin"/>
	<typeAlias alias="dpAnoc" type="com.omp.admin.contents.announce.model.DpAnoc"/>

	<resultMap id="dpCatAdminResult" class="dpCatAdmin" >
		<result column="DP_CAT_NO" property="dpCatNo" />
		<result column="DP_CAT_NM" property="dpCatNm" />
		<result column="DP_CAT_DESC" property="dpCatDesc" />
		<result column="DP_CAT_PRIOR" property="dpCatPrior" />
		<result column="DP_CAT_DEPTH" property="dpCatDepth" />
		<result column="SUB_CAT_YN" property="subCatYn" />
		<result column="USE_YN" property="useYn" />
		<result column="UP_DP_CAT_NO" property="upDpCatNo" />
		<result column="BODY_FILE_POS" property="bodyFilePos" />
		<result column="BODY_FILE_NM" property="bodyFileNm" />
		<result column="BODY_FILE_SIZE" property="bodyFileSize" />
		<result column="REG_ID" property="regId" />
		<result column="REG_DT" property="regDt" />
		<result column="UPD_ID" property="updId" />
		<result column="UPD_DT" property="updDt" />
		<result column="TARGET_URL" property="targetUrl" />
		<result column="CAT_PROD_CNT" property="catProdCnt" />
	</resultMap>

	<resultMap id="dpAnocPagingResult" class="dpAnoc" >
		<result property="totalCount" column="total_count"/>
		<result column="ANOC_SEQ" property="anocSeq" />
		<result column="ANOC_CD" property="anocCd" />
		<result column="ANOC_TITL" property="anocTitl" />
		<result column="ANOC_CONT" property="anocCont" />
		<result column="ANOC_STRT_DTTM" property="anocStrtDttm" />
		<result column="ANOC_END_DTTM" property="anocEndDttm" />
		<result column="READ_CNT" property="readCnt" />
		<result column="DEL_YN" property="delYn" />
		<result column="REG_ID" property="regId" />
		<result column="REG_DTTM" property="regDttm" />
		<result column="UPD_ID" property="updId" />
		<result column="UPD_DTTM" property="updDttm" />
		<result column="REG_NM" property="regNm" />
	</resultMap>

	<resultMap id="dpAnocResult" class="dpAnoc" >
		<result column="ANOC_SEQ" property="anocSeq" />
		<result column="ANOC_CD" property="anocCd" />
		<result column="ANOC_TITL" property="anocTitl" />
		<result column="ANOC_CONT" property="anocCont" />
		<result column="ANOC_STRT_DTTM" property="anocStrtDttm" />
		<result column="ANOC_END_DTTM" property="anocEndDttm" />
		<result column="READ_CNT" property="readCnt" />
		<result column="DEL_YN" property="delYn" />
		<result column="REG_ID" property="regId" />
		<result column="REG_DTTM" property="regDttm" />
		<result column="UPD_ID" property="updId" />
		<result column="UPD_DTTM" property="updDttm" />
	</resultMap>


	<statement id="Contents.selectCategoryList" parameterClass="dpCatAdmin" resultMap="dpCatAdminResult">
		SELECT /* Contents.selectCategoryList, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        DP_CAT_NO
		       ,DP_CAT_NM
		       ,DP_CAT_DESC
		       ,DP_CAT_PRIOR
		       ,DP_CAT_DEPTH
		       ,SUB_CAT_YN
		       ,USE_YN
		       ,UP_DP_CAT_NO
		       ,BODY_FILE_POS
		       ,BODY_FILE_NM
		       ,NVL(BODY_FILE_SIZE, 0) as BODY_FILE_SIZE
		       ,REG_ID
		       ,REG_DT
		       ,UPD_ID
		       ,UPD_DT
		       ,TARGET_URL
		       ,(SELECT COUNT(*) FROM TBL_DP_NEWFREE WHERE DP_CAT_NO = TA.DP_CAT_NO AND EXPO_YN = 'Y') CAT_PROD_CNT
		  FROM  TBL_DP_CAT TA
		 WHERE  UP_DP_CAT_NO = #upDpCatNo#
		 ORDER BY DP_CAT_PRIOR ASC, REG_DT ASC
		-- ORDER BY DP_CAT_PRIOR ASC, DP_CAT_NO
	</statement>

	<statement id="Contents.selectCategory" parameterClass="dpCatAdmin" resultMap="dpCatAdminResult">
		SELECT /* Contents.selectCategory, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        DP_CAT_NO
		       ,DP_CAT_NM
		       ,DP_CAT_DESC
		       ,DP_CAT_PRIOR
		       ,DP_CAT_DEPTH
		       ,SUB_CAT_YN
		       ,USE_YN
		       ,UP_DP_CAT_NO
		       ,BODY_FILE_POS
		       ,BODY_FILE_NM
		       ,NVL(BODY_FILE_SIZE, 0) as BODY_FILE_SIZE
		       ,REG_ID
		       ,REG_DT
		       ,UPD_ID
		       ,UPD_DT
		       ,TARGET_URL
		       ,(SELECT COUNT(*) FROM TBL_DP_CAT_PROD WHERE DP_CAT_NO = TA.DP_CAT_NO) CAT_PROD_CNT
		  FROM  TBL_DP_CAT TA
		 WHERE  UP_DP_CAT_NO = #upDpCatNo#
		   AND  DP_CAT_NO = #dpCatNo#
	</statement>

    <statement id="Contents.insertCategory" parameterClass="dpCatAdmin">
		INSERT /* Contents.insertCategory, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		       INTO TBL_DP_CAT (
		        DP_CAT_NO
		       ,DP_CAT_NM
		       ,DP_CAT_DESC
		       ,DP_CAT_PRIOR
		       ,DP_CAT_DEPTH
		       ,SUB_CAT_YN
		       ,USE_YN
		       ,UP_DP_CAT_NO
			<isNotNull property="bodyFileNm">
		       ,BODY_FILE_POS
		       ,BODY_FILE_NM
		       ,BODY_FILE_SIZE
			</isNotNull>   
		       ,REG_ID
		       ,REG_DT
			<isNotNull property="targetUrl">
		       ,TARGET_URL
			</isNotNull>
		) VALUES (
		<![CDATA[
			(SELECT  #upDpCatNo# || LPAD (NVL (SUBSTR (MAX (DP_CAT_NO), LENGTH (#upDpCatNo#) + 1), '0') + 1, 3, '0')
			   FROM  TBL_DP_CAT
			  WHERE  UP_DP_CAT_NO = #upDpCatNo#)
            ,#dpCatNm#
		    ,(SELECT  CASE WHEN COUNT(*) = 0 
		                  THEN #dpCatNm#
		                  ELSE MAX(DP_CAT_NM) || '>' || #dpCatNm#
		              END as DP_CAT_DESC
			    FROM  TBL_DP_CAT
			   WHERE  DP_CAT_NO = #upDpCatNo#
            )
            ,(SELECT NVL(MAX(DP_CAT_PRIOR) + 1, 1) FROM TBL_DP_CAT WHERE UP_DP_CAT_NO = #upDpCatNo#)
            ,(SELECT CASE WHEN COUNT(*) = 0 THEN 1 ELSE MAX(DP_CAT_DEPTH) + 1 END FROM TBL_DP_CAT WHERE DP_CAT_NO = #upDpCatNo#)
            ,'N'
            ,'N'
            ,#upDpCatNo#
		]]>
		<isNotNull property="bodyFileNm">
		    ,#bodyFilePos#
		    ,#bodyFileNm#
		    ,#bodyFileSize#
		</isNotNull>
		    ,#regId#
            ,TO_CHAR(SYSDATE,'yyyyMMdd')
		<isNotNull property="targetUrl">
		    ,#targetUrl#
		</isNotNull>
		)
    </statement>

    <statement id="Contents.updateCategory" parameterClass="dpCatAdmin">
		UPDATE /* Contents.updateCategory, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_CAT
		   SET  UPD_DT = TO_CHAR(SYSDATE,'yyyyMMdd')
		       ,UPD_ID = #updId#
		<isNotNull property="dpCatNm">
		       ,DP_CAT_NM = #dpCatNm#
		</isNotNull>
		<isNotNull property="dpCatNm">
		<isNotNull property="upDpCatNo">
		<![CDATA[
		       ,DP_CAT_DESC = (SELECT  CASE WHEN COUNT (*) = 0
		                                   THEN #dpCatNm#
		                                   ELSE MAX(DP_CAT_NM) || '>' || #dpCatNm#
		                               END
		                         FROM  TBL_DP_CAT
		                        WHERE  DP_CAT_NO = #upDpCatNo#
		                      )
		]]>
		</isNotNull>
		</isNotNull>
		<isNotNull property="dpCatPrior">
		<isNotEqual property="dpCatPrior" compareValue="0">
		       ,DP_CAT_PRIOR = #dpCatPrior#
		</isNotEqual>
		</isNotNull>
		<isNotNull property="useYn">
		       ,USE_YN       = #useYn#
		</isNotNull>
		<isNotNull property="targetUrl">
		       ,TARGET_URL   = #targetUrl#
		</isNotNull>
		<isNotNull property="bodyFileNm">
		       , BODY_FILE_POS = #bodyFilePos#
		       , BODY_FILE_NM = #bodyFileNm#
		       , BODY_FILE_SIZE = #bodyFileSize#
		</isNotNull>   
		 WHERE  DP_CAT_NO = #dpCatNo#
	</statement>

    <statement id="Contents.updateCategoryOpenYn" parameterClass="dpCatAdmin">
		UPDATE /* Contents.updateCategoryOpenYn, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_CAT
		   SET  UPD_DT = TO_CHAR(SYSDATE,'yyyyMMdd')
		       ,UPD_ID = #updId#
		       ,USE_YN = 'N'
		 WHERE  DP_CAT_NO = #dpCatNo#
    </statement>

    <statement id="Contents.updateCategoryPrior" parameterClass="dpCatAdmin">
		UPDATE /* Contents.updateCategoryPrior, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_CAT
		   SET  UPD_DT = TO_CHAR(SYSDATE,'yyyyMMdd')
		       ,UPD_ID = #updId#
		       ,DP_CAT_PRIOR = #dpCatPrior#
		 WHERE  DP_CAT_NO = #dpCatNo#
	</statement>

    <statement id="Contents.deleteCategory" parameterClass="dpCatAdmin">
        DELETE /* Contents.deleteCategory, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
                TBL_DP_CAT
         WHERE  DP_CAT_NO = #dpCatNo#
    </statement>

	<!-- Announce -->
	<statement id="Contents.selectAnnounceList" parameterClass="dpAnoc" resultMap="dpAnocPagingResult">
	   	<include refid="GOMP.pagingStart"/>
		SELECT /* Contents.selectAnnounceList, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		   	<include refid="GOMP.pagingTotalCount"/>
		        TA.ANOC_SEQ
		       ,TA.ANOC_CD
		       ,TA.ANOC_TITL
		       ,TA.ANOC_CONT
		       ,TA.ANOC_STRT_DTTM
		       ,TA.ANOC_END_DTTM
		       ,TA.READ_CNT
		       ,TA.DEL_YN
		       ,TA.REG_ID
		       ,TA.REG_DTTM
		       ,TA.UPD_ID
		       ,TA.UPD_DTTM
		       ,TB.MGR_NM as REG_NM
		  FROM  TBL_DP_ANOC TA, TBL_AD_MGR TB
		 WHERE  TA.REG_DTTM BETWEEN #anocStrtDttm# AND #anocEndDttm#
		   AND  TA.REG_ID = TB.MGR_ID
		<isNotNull property="anocCd">
		   AND  TA.ANOC_CD = #anocCd#
		</isNotNull>
		 ORDER BY TA.ANOC_STRT_DTTM DESC, TA.ANOC_END_DTTM DESC
		-- ORDER BY TA.ANOC_SEQ DESC
	   	<include refid="GOMP.pagingEnd"/>
	</statement>

	<statement id="Contents.selectAnnounce" parameterClass="dpAnoc" resultMap="dpAnocResult">
		SELECT /* Contents.selectAnnounce, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        ANOC_SEQ
		       ,ANOC_CD
		       ,ANOC_TITL
		       ,ANOC_CONT
		       ,ANOC_STRT_DTTM
		       ,ANOC_END_DTTM
		       ,READ_CNT
		       ,DEL_YN
		       ,REG_ID
		       ,REG_DTTM
		       ,UPD_ID
		       ,UPD_DTTM
		  FROM  TBL_DP_ANOC
		 WHERE  ANOC_SEQ = #anocSeq#
	</statement>

    <statement id="Contents.insertAnnounce" parameterClass="dpAnoc">
		INSERT /* Contents.insertAnnounce, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		       INTO TBL_DP_ANOC (
		        ANOC_SEQ
		       ,ANOC_CD
		       ,ANOC_TITL
		       ,ANOC_CONT
		       ,ANOC_STRT_DTTM
		       ,ANOC_END_DTTM
		       ,READ_CNT
		       ,DEL_YN
		       ,REG_ID
		       ,REG_DTTM
		) VALUES (
		        SEQ_ANOC_SEQ.NEXTVAL
		       ,#anocCd#
		       ,#anocTitl#
		       ,#anocCont#
		       ,#anocStrtDttm#
		       ,#anocEndDttm#
		       ,0
		       ,'N'
		       ,#regId#
		       ,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		)
	</statement>

	<statement id="Contents.updateAnnounce" parameterClass="dpAnoc">
		UPDATE /* Contents.updateAnnounce, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_ANOC
		   SET  ANOC_CD = #anocCd#
		       ,ANOC_TITL = #anocTitl#
		       ,ANOC_CONT = #anocCont#
		       ,ANOC_STRT_DTTM = #anocStrtDttm#
		       ,ANOC_END_DTTM = #anocEndDttm#
		       ,DEL_YN = 'N'
		       ,UPD_ID = #updId#
		       ,UPD_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		 WHERE  ANOC_SEQ = #anocSeq#
	</statement>

	<statement id="Contents.updateAnnounceDelYn" parameterClass="dpAnoc">
		UPDATE /* Contents.updateAnnounceDelYn, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_ANOC
		   SET  DEL_YN = 'Y'
		       ,UPD_ID = #updId#
		       ,UPD_DTTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
		 WHERE  ANOC_SEQ = #anocSeq#
	</statement>

	<statement id="Contents.deleteAnnounce" parameterClass="dpAnoc">
		DELETE /* Contents.deleteAnnounce, AdminPoC, jslee, 2011.03.21 : Contents_SqlMap.xml */
		        TBL_DP_ANOC
		 WHERE  ANOC_SEQ = #anocSeq#
	</statement>
	
	<!-- Admin Recommend -->
	<typeAlias alias="dpAdminRecommendParam" type="com.omp.admin.contents.adminrec.model.AdminRecommendParam"/>
	<typeAlias alias="dpCategory" type="com.omp.admin.contents.adminrec.model.DpCategoryList"/>
	<typeAlias alias="dpAdminRecommend" type="com.omp.admin.contents.adminrec.model.AdminRecommend"/>
	<typeAlias alias="dpBestParam" type="com.omp.admin.contents.best.model.BestParam"/>
	
	<resultMap id="dpCategoryResult" class="dpCategory" >
		<result column="DP_CAT_NO" 		property="dpCatNo" />
		<result column="DP_CAT_NM" 		property="dpCatNm" />
		<result column="DP_CAT_DESC" 	property="dpCatDesc" />
		<result column="DP_CAT_PRIOR" 	property="dpCatPrior" />
	</resultMap>
	<resultMap id="dpAdminRecommendResult" class="dpAdminRecommend" >
		<result column="RNUM" 			property="rnum" />
		<result column="TOTAL_COUNT" 	property="totalCount" />
		<result column="CAT_NO" 		property="catNo" />
		<result column="CAT_NM" 		property="catNm" />
		<result column="FILE_POS" 		property="filePos" />
		<result column="PROD_ID" 		property="prodId" />
		<result column="PROD_NM" 		property="prodNm" />
		<result column="PROD_GRD_CD" 	property="prodGrdCd" />
		<result column="MBR_NO" 		property="mbrNo" />
		<result column="MBR_ID" 		property="mbrId" />
		<result column="MBR_NM" 		property="mbrNm" />
		<result column="DWLD_CNT" 		property="dwldCnt" />
		<result column="REG_DT" 		property="regDt" />
		<result column="EXPO_YN_NM" 	property="expoYnNm" />
		<result column="EXPO_YN" 		property="expoYn" />
		<result column="EXPO_PRIOR" 	property="expoPrior" />
		<result column="AID" 			property="aid" />
	</resultMap>
	<resultMap id="dpAdminProdResult" class="dpAdminRecommend" >
		<result column="RNUM" 			property="rnum" />
		<result column="TOTAL_COUNT" 	property="totalCount" />
		<result column="CAT_NO" 		property="catNo" />
		<result column="CAT_NM" 		property="catNm" />
		<result column="FILE_POS" 		property="filePos" />
		<result column="PROD_ID" 		property="prodId" />
		<result column="PROD_NM" 		property="prodNm" />
		<result column="MBR_NO" 		property="mbrNo" />
		<result column="MBR_ID" 		property="mbrId" />
		<result column="MBR_NM" 		property="mbrNm" />
		<result column="DWLD_CNT" 		property="dwldCnt" />
		<result column="AID" 			property="aid" />
		<result column="PROD_AMT" 		property="prodAmt" />
		<result column="REG_DT" 		property="regDt" />
	</resultMap>
	<resultMap id="dpAdminProdDtlResult" class="dpAdminRecommend" >
		<result column="PROD_ID" 		property="prodId" />
		<result column="FILE_POS" 		property="filePos" />
		<result column="PROD_NM" 		property="prodNm" />
		<result column="PROD_DESC" 		property="prodDesc" />
		<result column="PROD_AMT" 		property="prodAmt" />
		<result column="DWLD_CNT" 		property="dwldCnt" />
		<result column="PROD_GRD_CD" 	property="prodGrdCd" />
		<result column="FILE_SIZE" 		property="fileSize" />
		<result column="MBR_ID" 		property="mbrId" />
		<result column="MBR_NM" 		property="mbrNm" />
		<result column="MBR_NO" 		property="mbrNo" />
		<result column="REG_DT" 		property="regDt" />
		<result column="UPD_DT" 		property="updDt" />
		<result column="PLAT_CLS_CD" 	property="platClsCd" />
	</resultMap>
	<statement id="Contents.selectAdminCategoryList" parameterClass="dpAdminRecommendParam" resultMap="dpCategoryResult">
		SELECT  /* Contents.selectAdminCategoryList swjoo 2011.05.11 : Contents_SqlMap.xml */
				DP_CAT_NO
		       ,DP_CAT_NM
		       ,DP_CAT_DESC
		       ,DP_CAT_PRIOR
		  FROM 	TBL_DP_CAT
		 WHERE 	USE_YN = 'Y'
		   AND 	SUBSTR(DP_CAT_NO,1,4) = #dpUpCatNo#
		 ORDER BY DP_CAT_DEPTH, DP_CAT_PRIOR
	</statement>
	<statement id="Contents.selectAdminCategoryList2" parameterClass="dpBestParam" resultMap="dpCategoryResult">
		SELECT  /* Contents.selectAdminCategoryList2 swjoo 2011.05.11 : Contents_SqlMap.xml */
				DP_CAT_NO
		       ,DP_CAT_NM
		       ,DP_CAT_DESC
		       ,DP_CAT_PRIOR
		  FROM 	TBL_DP_CAT
		 WHERE 	USE_YN = 'Y'
		   AND 	SUBSTR(DP_CAT_NO,1,4) = #dpUpCatNo#
		 ORDER BY DP_CAT_DEPTH, DP_CAT_PRIOR
	</statement>
	<statement id="Contents.selectAdminRecommendList" parameterClass="dpAdminRecommendParam" resultMap="dpAdminRecommendResult">
		<include refid="GOMP.pagingStart"/>
		        SELECT 
		        	   /* Contents.selectAdminRecommendList swjoo 2011.05.11 : Contents_SqlMap.xml */
		        	   <include refid="GOMP.pagingTotalCount"/>
		        	   A.DP_CAT_NO AS CAT_NO,
		        	   (SELECT DP_CAT_NM FROM TBL_DP_CAT C WHERE C.DP_CAT_NO = A.DP_CAT_NO) AS CAT_NM,
		               (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = A.PROD_ID AND PA.IMG_CLS = 'DP000108') AS FILE_POS,
		               P.PROD_ID,
		               P.PROD_NM,
		               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PROD_GRD_CD = CC.DTL_FULL_CD) AS PROD_GRD_CD,
		               M.MBR_NO,
		               M.MBR_ID,
		               M.MBR_NM,
		               NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
		               P.REG_DT,
		               DECODE(A.EXPO_YN,'Y','노출','숨김') AS EXPO_YN_NM,
		               A.EXPO_YN,
		               A.EXPO_PRIOR,
		               P.AID
		          FROM TBL_DP_ADMIN_RECOMMAND A,
		               TBL_DP_PROD P,
		               TBL_US_MEMBER M
		         WHERE A.PROD_ID = P.PROD_ID
		           AND P.MBR_NO = M.MBR_NO
		           AND P.PROD_STAT_CD = 'PD000404'
		           AND A.SCR_GBN = #scrGbn# --'DP005103' --추천 , DP005105 필수
		           AND A.DP_CAT_NO = #dpCatNo#
		         ORDER BY A.EXPO_PRIOR
		<include refid="GOMP.pagingEnd"/>
	</statement>
	<statement id="Contents.popAdminProdList" parameterClass="dpAdminRecommendParam" resultMap="dpAdminProdResult">
		<include refid="GOMP.pagingStart"/>
		        SELECT 
		        	   /* Contents.popAdminProdList swjoo 2011.05.11 : Contents_SqlMap.xml */
		        	   <include refid="GOMP.pagingTotalCount"/>
				       (SELECT DP_CAT_NM FROM TBL_DP_CAT C WHERE C.DP_CAT_NO = CP.DP_CAT_NO) AS CAT_NM,
				       CP.DP_CAT_NO AS CAT_NO,
				       (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = P.PROD_ID AND PA.IMG_CLS = 'DP000108') AS FILE_POS,
				       P.PROD_ID,
				       P.PROD_NM,
				       P.PROD_AMT,
				       M.MBR_NO,
				       M.MBR_ID,
				       CASE WHEN M.MBR_CLS_CD = 'US000101' OR M.MBR_CLS_CD = 'US000103' THEN M.MBR_NM
				            WHEN M.MBR_CLS_CD = 'US000102' THEN M.COMP_NM
				            ELSE ''
				       END AS MBR_NM,
				       NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE P.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
				       P.AID,
				       P.REG_DT
				       --, TO_CHAR(TO_DATE(P.REG_DT), 'YYYY-MM-DD') REG_DT2
				  FROM TBL_DP_PROD P,
				       TBL_DP_CAT_PROD CP,
				       TBL_US_MEMBER M
				 WHERE P.PROD_ID = CP.PROD_ID
				   AND P.MBR_NO = M.MBR_NO
				   AND P.PROD_STAT_CD = 'PD000404'
				<isEqual property="dpCatNo" compareValue="DP01">
				   AND SUBSTR(CP.DP_CAT_NO,1,4) = #dpUpCatNo#
				</isEqual>
				<isNotEqual property="dpCatNo" compareValue="DP01">
				   AND  CP.DP_CAT_NO = #dpCatNo#
				</isNotEqual>
				<isNotEmpty property="dpProdNm" >
				   AND P.PROD_NM LIKE '%'||#dpProdNm#||'%' 	
				</isNotEmpty>
				<isNotEmpty property="aid" >
				   AND P.AID LIKE #aid#||'%' 	
				</isNotEmpty>
				 ORDER BY P.REG_DT DESC
		<include refid="GOMP.pagingEnd"/>
	</statement>
	<statement id="Contents.popAdminProdDetail" parameterClass="string" resultMap="dpAdminProdDtlResult">
			SELECT 
				   /* Contents.popAdminProdDetail swjoo 2011.05.11 : Contents_SqlMap.xml */
				   PROD_ID,
			       FILE_POS,
			       PROD_NM,
			       PROD_DESC,
			       PROD_AMT,
			       DWLD_CNT,
			       PROD_GRD_CD,
			       MAX(FILE_SIZE) AS FILE_SIZE,
			       MBR_ID,
			       MBR_NM,
			       MBR_NO,
			       REG_DT,
			       --REG_DT2,
			       UPD_DT,
			       --UPD_DT2,
			       PLAT_CLS_CD
			  FROM (
			        SELECT
			               P.PROD_ID,
			               (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = P.PROD_ID AND PA.IMG_CLS = 'DP000109') AS FILE_POS,
			               P.PROD_NM,
			               P.PROD_DESC,
			               P.PROD_AMT,
			               NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE P.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
			               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PROD_GRD_CD = CC.DTL_FULL_CD) AS PROD_GRD_CD,
			               SC.FILE_SIZE,
			               M.MBR_ID,
			               M.MBR_NM,
			               M.MBR_NO,
			               P.REG_DT,
			               --TO_CHAR(TO_DATE(P.REG_DT),'YYYY.MM.DD') AS REG_DT2,
			               P.UPD_DT,
			               --TO_CHAR(TO_DATE(P.UPD_DT),'YYYY.MM.DD') AS UPD_DT2,
			               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PLAT_CLS_CD = CC.DTL_FULL_CD) AS PLAT_CLS_CD
			          FROM TBL_DP_PROD P,
			               TBL_DP_SUB_CONTS SC,
			               TBL_US_MEMBER M
			         WHERE P.PROD_ID = SC.PROD_ID
			           AND P.MBR_NO = M.MBR_NO
			           AND P.PROD_STAT_CD = 'PD000404'
			           AND P.PROD_ID = #prodId#
			       )
			  GROUP BY PROD_ID,
			           FILE_POS,
			           PROD_NM,
			           PROD_DESC,
			           PROD_AMT,
			           DWLD_CNT,
			           PROD_GRD_CD,
			           MBR_ID,
			           MBR_NM,
			           MBR_NO,
			           REG_DT,
			           --REG_DT2,
			           UPD_DT,
			           --UPD_DT2,
			           PLAT_CLS_CD
	</statement>
	<statement id="Contents.insertAdminRecommendProdChk" parameterClass="dpAdminRecommendParam" resultClass="int">
		SELECT 
				/* Contents.insertAdminRecommendProdChk swjoo 2011.05.11 : Contents_SqlMap.xml */
				COUNT(*) CHK 
		  FROM TBL_DP_ADMIN_RECOMMAND
		 WHERE SCR_GBN = #scrGbn#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #inProdId#
	</statement>
	<statement id="Contents.insertAdminRecommendProd" parameterClass="dpAdminRecommendParam">
		INSERT 
		/* Contents.insertAdminRecommendProd swjoo 2011.05.11 : Contents_SqlMap.xml */ 
		INTO TBL_DP_ADMIN_RECOMMAND
		(
		  SCR_GBN
		  ,DP_CAT_NO
		  ,PROD_ID
		  ,EXPO_YN
		  ,EXPO_PRIOR
		  ,REG_ID
		  ,REG_DT
		  ,REG_TM
		  ,UPD_ID
		  ,UPD_DT
		  ,UPD_TM
		) 
		SELECT 
			#scrGbn#
		    , #dpCatNo#
		    , #inProdId#
		    , 'Y'
		    , NVL(MAX(EXPO_PRIOR) + 1, 1) 
		    , #regId#
		    , TO_CHAR(SYSDATE, 'YYYYMMDD')
		    , TO_CHAR(SYSDATE, 'HH24MISS')
		    , #updId#
		    , TO_CHAR(SYSDATE, 'YYYYMMDD')
		    , TO_CHAR(SYSDATE, 'HH24MISS')
         FROM TBL_DP_ADMIN_RECOMMAND A,
              TBL_DP_PROD P
	    WHERE A.PROD_ID = P.PROD_ID
	      AND P.PROD_STAT_CD = 'PD000404'
	      AND A.SCR_GBN = #scrGbn# 
          AND A.DP_CAT_NO = #dpCatNo#
	</statement>
	<statement id="Contents.updateAdminRecommendList" parameterClass="dpAdminRecommendParam">
		UPDATE 
				/* Contents.updateAdminRecommendList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_ADMIN_RECOMMAND
		   SET EXPO_YN = #expoYn#
		       ,EXPO_PRIOR = #expoPrior#
		       ,UPD_ID = #updId#
		       ,UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		       ,UPD_TM = TO_CHAR(SYSDATE, 'HH24MISS')
		 WHERE SCR_GBN = #scrGbn#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.deleteAdminRecommendList" parameterClass="dpAdminRecommendParam">
		DELETE 
				/* Contents.deleteAdminRecommendList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_ADMIN_RECOMMAND
		 WHERE SCR_GBN = #scrGbn#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.selectChargeBestList" parameterClass="dpBestParam" resultMap="dpAdminRecommendResult">
		<include refid="GOMP.pagingStart"/>
		        SELECT 
		        		/* Contents.selectChargeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
		        		<include refid="GOMP.pagingTotalCount"/>
		        	   A.DP_CAT_NO AS CAT_NO,
		        	   (SELECT DP_CAT_NM FROM TBL_DP_CAT C WHERE C.DP_CAT_NO = A.DP_CAT_NO) AS CAT_NM,
		               (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = A.PROD_ID AND PA.IMG_CLS = 'DP000108') AS FILE_POS,
		               P.PROD_ID,
		               P.PROD_NM,
		               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PROD_GRD_CD = CC.DTL_FULL_CD) AS PROD_GRD_CD,
		               M.MBR_NO,
		               M.MBR_ID,
		               M.MBR_NM,
		               NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
		               P.REG_DT,
		               DECODE(A.EXPO_YN,'Y','노출','숨김') AS EXPO_YN_NM,
		               A.EXPO_YN,
		               A.EXPO_PRIOR,
		               P.AID
		          FROM TBL_DP_PAY_DWLD_BEST A,
		               TBL_DP_PROD P,
		               TBL_US_MEMBER M
		         WHERE A.PROD_ID = P.PROD_ID
		           AND P.MBR_NO = M.MBR_NO
		           AND P.PROD_STAT_CD = 'PD000404'
		           AND P.PROD_CHRG_CLS = 'Y'
		           AND A.DP_CAT_NO = #dpCatNo#
		           AND A.WK_START_DT = #dpSelectDateDB#
		           AND A.WK_END_DT = #dpSelectDateDB#
		         ORDER BY A.EXPO_PRIOR
		<include refid="GOMP.pagingEnd"/>
	</statement>
	<statement id="Contents.updateChargeBestList" parameterClass="dpBestParam">
		UPDATE 
				/* Contents.updateChargeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_PAY_DWLD_BEST
		   SET EXPO_YN = #expoYn#
		       ,EXPO_PRIOR = #expoPrior#
		 WHERE WK_START_DT = #dpSelectDateDB#
		   AND WK_END_DT = #dpSelectDateDB#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.deleteChargeBestList" parameterClass="dpBestParam">
		DELETE 
				/* Contents.deleteChargeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_PAY_DWLD_BEST
		 WHERE WK_START_DT = #dpSelectDateDB#
		   AND WK_END_DT = #dpSelectDateDB#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.selectFreeBestList" parameterClass="dpBestParam" resultMap="dpAdminRecommendResult">
		<include refid="GOMP.pagingStart"/>
		        SELECT 
		        		/* Contents.selectFreeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
		        		<include refid="GOMP.pagingTotalCount"/>
		        	   A.DP_CAT_NO AS CAT_NO,
		        	   (SELECT DP_CAT_NM FROM TBL_DP_CAT C WHERE C.DP_CAT_NO = A.DP_CAT_NO) AS CAT_NM,
		               (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = A.PROD_ID AND PA.IMG_CLS = 'DP000108') AS FILE_POS,
		               P.PROD_ID,
		               P.PROD_NM,
		               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PROD_GRD_CD = CC.DTL_FULL_CD) AS PROD_GRD_CD,
		               M.MBR_NO,
		               M.MBR_ID,
		               M.MBR_NM,
		               NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
		               P.REG_DT,
		               DECODE(A.EXPO_YN,'Y','노출','숨김') AS EXPO_YN_NM,
		               A.EXPO_YN,
		               A.EXPO_PRIOR,
		               P.AID
		          FROM TBL_DP_FREE_DWLD_BEST A,
		               TBL_DP_PROD P,
		               TBL_US_MEMBER M
		         WHERE A.PROD_ID = P.PROD_ID
		           AND P.MBR_NO = M.MBR_NO
		           AND P.PROD_STAT_CD = 'PD000404'
		           AND P.PROD_CHRG_CLS = 'N'
		           AND A.DP_CAT_NO = #dpCatNo#
		           AND A.WK_START_DT = #dpSelectDateDB#
		           AND A.WK_END_DT = #dpSelectDateDB#
		         ORDER BY A.EXPO_PRIOR
		<include refid="GOMP.pagingEnd"/>
	</statement>
	<statement id="Contents.updateFreeBestList" parameterClass="dpBestParam">
		UPDATE 
				/* Contents.updateFreeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_FREE_DWLD_BEST
		   SET EXPO_YN = #expoYn#
		       ,EXPO_PRIOR = #expoPrior#
		 WHERE WK_START_DT = #dpSelectDateDB#
		   AND WK_END_DT = #dpSelectDateDB#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.deleteFreeBestList" parameterClass="dpBestParam">
		DELETE 
				/* Contents.deleteFreeBestList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_FREE_DWLD_BEST
		 WHERE WK_START_DT = #dpSelectDateDB#
		   AND WK_END_DT = #dpSelectDateDB#
		   AND DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.selectNewUpdateList" parameterClass="dpAdminRecommendParam" resultMap="dpAdminRecommendResult">
		<include refid="GOMP.pagingStart"/>
		        SELECT 
		        		/* Contents.selectNewUpdateList swjoo 2011.05.11 : Contents_SqlMap.xml */
		        		<include refid="GOMP.pagingTotalCount"/>
		        	   A.DP_CAT_NO AS CAT_NO,
		        	   (SELECT DP_CAT_NM FROM TBL_DP_CAT C WHERE C.DP_CAT_NO = A.DP_CAT_NO) AS CAT_NM,
		               (SELECT FILE_POS FROM TBL_DP_PROD_IMG PA WHERE PA.PROD_ID = A.PROD_ID AND PA.IMG_CLS = 'DP000108') AS FILE_POS,
		               P.PROD_ID,
		               P.PROD_NM,
		               (SELECT CC.CD_NM FROM TBL_COMM_CD CC WHERE P.PROD_GRD_CD = CC.DTL_FULL_CD) AS PROD_GRD_CD,
		               M.MBR_NO,
		               M.MBR_ID,
		               M.MBR_NM,
		               NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT,
		               P.REG_DT,
		               DECODE(A.EXPO_YN,'Y','노출','숨김') AS EXPO_YN_NM,
		               A.EXPO_YN,
		               A.EXPO_PRIOR,
		               P.AID
		          FROM TBL_DP_NEWFREE A,
		               TBL_DP_PROD P,
		               TBL_US_MEMBER M
		         WHERE A.PROD_ID = P.PROD_ID
		           AND P.MBR_NO = M.MBR_NO
		           AND P.PROD_STAT_CD = 'PD000404'
		           AND A.DP_CAT_NO = #dpCatNo#

		         ORDER BY A.EXPO_PRIOR ASC, A.REG_DT DESC
		<include refid="GOMP.pagingEnd"/>
	</statement>
	<statement id="Contents.updateNewUpdateList" parameterClass="dpAdminRecommendParam">
		UPDATE 
				/* Contents.updateNewUpdateList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_NEWFREE
		   SET EXPO_YN = #expoYn#
		       ,EXPO_PRIOR = #expoPrior#
		       ,UPD_ID = #updId#
		       ,UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHHMISS')
		 WHERE DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.deleteNewUpdateList" parameterClass="dpAdminRecommendParam">
		DELETE 
				/* Contents.deleteNewUpdateList swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_NEWFREE
		 WHERE DP_CAT_NO = #dpCatNo#
		   AND PROD_ID = #checkProdId# 
	</statement>
	<statement id="Contents.insertBestPayProdChk" parameterClass="dpBestParam" resultClass="int">
		SELECT COUNT(*) AS CHK FROM TBL_DP_PAY_DWLD_BEST
		WHERE REG_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</statement>
	<statement id="Contents.insertBestFreeProdChk" parameterClass="dpBestParam" resultClass="int">
		SELECT COUNT(*) AS CHK FROM TBL_DP_FREE_DWLD_BEST
		WHERE REG_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</statement>
	<statement id="Contents.insertBestPayProd" parameterClass="dpBestParam">
		INSERT INTO TBL_DP_PAY_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
		SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
		     , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			 , A.*
		     , ROWNUM EXPO_PRIOR
		     , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
		     , 'Y' AS EXPO_YN
		  FROM
		  (
		      SELECT
		         A.DP_CAT_NO AS DP_CAT_NO,
		         P.PROD_ID   AS PROD_ID,
		         NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT
		        FROM TBL_DP_NEWFREE A,
		             TBL_DP_PROD P
		       WHERE A.PROD_ID = P.PROD_ID
		         --AND A.DP_CAT_NO = 'DP01'
		         AND A.EXPO_YN = 'Y'
		         AND A.PAY_YN = 'Y'
		       ORDER BY A.EXPO_PRIOR, A.REG_DT
		  )A
		WHERE ROWNUM BETWEEN 1 AND 100
		)
	</statement>
	<statement id="Contents.insertBestFreeProd" parameterClass="dpBestParam">
		INSERT INTO TBL_DP_FREE_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
		SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
		     , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			 , A.*
		     , ROWNUM EXPO_PRIOR
		     , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
		     , 'Y' AS EXPO_YN
		  FROM
		  (
		      SELECT
		         A.DP_CAT_NO AS DP_CAT_NO,
		         P.PROD_ID   AS PROD_ID,
		         NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT
		        FROM TBL_DP_NEWFREE A,
		             TBL_DP_PROD P
		       WHERE A.PROD_ID = P.PROD_ID
		         --AND A.DP_CAT_NO = 'DP01'
		         AND A.EXPO_YN = 'Y'
		         AND A.PAY_YN = 'N'
		       ORDER BY A.EXPO_PRIOR, A.REG_DT
		  )A
		WHERE ROWNUM BETWEEN 1 AND 100
		)
	</statement>
	<statement id="Contents.selectChargeBestDefaultPayChkCnt" parameterClass="dpBestParam" resultClass="int">
		SELECT
			/* Contents.selectChargeBestDefaultPayChkCnt swjoo 2011.05.11 : Contents_SqlMap.xml */ 
			COUNT(*) CNT
		FROM
		(      
		      SELECT
		           TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS TODAY
		           , DP_CAT_NO
		           ,  PROD_ID
		           ,  COUNT(PROD_ID) CNT
		      FROM
		      (
		            SELECT PI.PRCHS_DT
		                 , PI.PRCHS_ID
		                 , CP.DP_CAT_NO
		                 , PE.PROD_ID
		              FROM TBL_OD_PRCHS_INFO     PI
		                 , TBL_OD_EXP_PRCHS_INFO PE
		                 , TBL_DP_PROD           PR
		                 , TBL_DP_CAT_PROD       CP
		             WHERE PI.PRCHS_ID  = PE.PRCHS_ID
		               AND PE.PROD_ID  = PR.PROD_ID
		               AND PE.PROD_ID   = CP.PROD_ID
		               AND PR.PROD_STAT_CD = 'PD000404'  --판매중
		               AND CP.DP_YN = 'Y'                -- 전시중 
		               AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
		               AND PR.PROD_CHRG_CLS = 'Y'        -- 'Y':유료,'N':무료
		               AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
					<isNotEqual property="dpCatNo" compareValue="DP01">
					   AND  CP.DP_CAT_NO = #dpCatNo#
					</isNotEqual>
		      )
		      GROUP BY DP_CAT_NO, PROD_ID
		      ORDER BY COUNT(PROD_ID) DESC
		)   
	</statement>
	<statement id="Contents.insertChargeBestDefaultPay" parameterClass="dpBestParam">
		INSERT INTO 
			/* Contents.insertChargeBestDefaultPay swjoo 2011.05.11 : Contents_SqlMap.xml */  
			TBL_DP_PAY_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
		  SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
		       , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			<isEqual property="dpCatNo" compareValue="DP01">
			   , 'DP01' AS DP_CAT_NO
			</isEqual>
			<isNotEqual property="dpCatNo" compareValue="DP01">
			   , A.DP_CAT_NO
			</isNotEqual>
		       , A.PROD_ID
		       , A.DWLD_CNT
		       , ROWNUM EXPO_PRIOR
		       , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
		       , 'Y' AS EXPO_YN
		    FROM
		    (
		        SELECT
		                DP_CAT_NO
		             ,  PROD_ID
		             ,  COUNT(PROD_ID) DWLD_CNT
		        FROM
		        (
		              SELECT PI.PRCHS_DT
		                   , PI.PRCHS_ID
		                   , CP.DP_CAT_NO
		                   , PE.PROD_ID
		                FROM TBL_OD_PRCHS_INFO     PI
		                   , TBL_OD_EXP_PRCHS_INFO PE
		                   , TBL_DP_PROD           PR
		                   , TBL_DP_CAT_PROD       CP
		               WHERE PI.PRCHS_ID  = PE.PRCHS_ID
		                 AND PE.PROD_ID  = PR.PROD_ID
		                 AND PE.PROD_ID   = CP.PROD_ID
		                 AND PR.PROD_STAT_CD = 'PD000404'  --판매중
		                 AND CP.DP_YN = 'Y'                -- 전시중 
		                 AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
		                 AND PR.PROD_CHRG_CLS = 'Y'        -- 'Y':유료,'N':무료
		                 AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
					  <isNotEqual property="dpCatNo" compareValue="DP01">
						 AND  CP.DP_CAT_NO = #dpCatNo#
					  </isNotEqual>
		        )
		        GROUP BY DP_CAT_NO, PROD_ID
		        ORDER BY COUNT(PROD_ID) DESC
		    )A
		  WHERE ROWNUM BETWEEN 1 AND 150
		)
	</statement>
	<statement id="Contents.insertChargeBestDefaultPay2" parameterClass="dpBestParam">
		INSERT INTO 
			/* Contents.insertChargeBestDefaultPay2 swjoo 2011.05.11 : Contents_SqlMap.xml */  
			TBL_DP_PAY_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
			SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
			     , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			  <isEqual property="dpCatNo" compareValue="DP01">
				 , 'DP01' AS DP_CAT_NO
			  </isEqual>
			  <isNotEqual property="dpCatNo" compareValue="DP01">
				 , A.DP_CAT_NO
			  </isNotEqual>
			     , A.PROD_ID
			     , A.DWLD_CNT
			     , ROWNUM + #payChkCnt# EXPO_PRIOR
			     , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
			     , 'Y' AS EXPO_YN
			  FROM
			  (
			      SELECT
			             A.DP_CAT_NO AS DP_CAT_NO,
			             P.PROD_ID   AS PROD_ID,
			             NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT
			        FROM TBL_DP_CAT_PROD A,
			             TBL_DP_PROD P
			       WHERE A.PROD_ID = P.PROD_ID
				  <isNotEqual property="dpCatNo" compareValue="DP01">
					 AND  A.DP_CAT_NO = #dpCatNo#
				  </isNotEqual>
			         AND P.PROD_STAT_CD = 'PD000404'  --판매중
			         AND A.DP_YN = 'Y'                -- 전시중
			         AND P.PROD_CHRG_CLS = 'Y'        -- 'Y':유료,'N':무료
			         AND A.PROD_ID NOT IN(
			                              SELECT DISTINCT PE.PROD_ID
			                                FROM TBL_OD_PRCHS_INFO     PI
			                                   , TBL_OD_EXP_PRCHS_INFO PE
			                                   , TBL_DP_PROD           PR
			                                   , TBL_DP_CAT_PROD       CP
			                               WHERE PI.PRCHS_ID  = PE.PRCHS_ID
			                                 AND PE.PROD_ID  = PR.PROD_ID
			                                 AND PE.PROD_ID   = CP.PROD_ID
			                                 AND PR.PROD_STAT_CD = 'PD000404'  --판매중
			                                 AND CP.DP_YN = 'Y'                -- 전시중 
			                                 AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
			                                 AND PR.PROD_CHRG_CLS = 'Y'        -- 'Y':유료,'N':무료
			                                 AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
										  <isNotEqual property="dpCatNo" compareValue="DP01">
											 AND  CP.DP_CAT_NO = #dpCatNo#
										  </isNotEqual>
			                              )
			       ORDER BY P.REG_DT DESC, P.REG_TM DESC
			  )A
			WHERE ROWNUM BETWEEN 1 AND #payTotCnt#
		)
	</statement>
	<statement id="Contents.deleteChargeBestDefaultPay" parameterClass="dpBestParam">
		DELETE 
				/* Contents.deleteChargeBestDefaultPay swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_PAY_DWLD_BEST
		 WHERE DP_CAT_NO = #dpCatNo#
		   AND REG_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</statement>
	
	<statement id="Contents.selectFreeBestDefaultPayChkCnt" parameterClass="dpBestParam" resultClass="int">
		SELECT
			/* Contents.selectFreeBestDefaultPayChkCnt swjoo 2011.05.11 : Contents_SqlMap.xml */ 
			COUNT(*) CNT
		FROM
		(      
		      SELECT
		           TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS TODAY
		           , DP_CAT_NO
		           ,  PROD_ID
		           ,  COUNT(PROD_ID) CNT
		      FROM
		      (
		            SELECT PI.PRCHS_DT
		                 , PI.PRCHS_ID
		                 , CP.DP_CAT_NO
		                 , PE.PROD_ID
		              FROM TBL_OD_PRCHS_INFO     PI
		                 , TBL_OD_EXP_PRCHS_INFO PE
		                 , TBL_DP_PROD           PR
		                 , TBL_DP_CAT_PROD       CP
		             WHERE PI.PRCHS_ID  = PE.PRCHS_ID
		               AND PE.PROD_ID  = PR.PROD_ID
		               AND PE.PROD_ID   = CP.PROD_ID
		               AND PR.PROD_STAT_CD = 'PD000404'  --판매중
		               AND CP.DP_YN = 'Y'                -- 전시중 
		               AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
		               AND PR.PROD_CHRG_CLS = 'N'        -- 'Y':유료,'N':무료
		               AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
					<isNotEqual property="dpCatNo" compareValue="DP01">
					   AND  CP.DP_CAT_NO = #dpCatNo#
					</isNotEqual>
		      )
		      GROUP BY DP_CAT_NO, PROD_ID
		      ORDER BY COUNT(PROD_ID) DESC
		)   
	</statement>
	<statement id="Contents.insertFreeBestDefaultPay" parameterClass="dpBestParam">
		INSERT INTO 
			/* Contents.insertFreeBestDefaultPay swjoo 2011.05.11 : Contents_SqlMap.xml */  
			TBL_DP_FREE_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
		  SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
		       , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			<isEqual property="dpCatNo" compareValue="DP01">
			   , 'DP01' AS DP_CAT_NO
			</isEqual>
			<isNotEqual property="dpCatNo" compareValue="DP01">
			   , A.DP_CAT_NO
			</isNotEqual>
		       , A.PROD_ID
		       , A.DWLD_CNT
		       , ROWNUM EXPO_PRIOR
		       , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
		       , 'Y' AS EXPO_YN
		    FROM
		    (
		        SELECT
		                DP_CAT_NO
		             ,  PROD_ID
		             ,  COUNT(PROD_ID) DWLD_CNT
		        FROM
		        (
		              SELECT PI.PRCHS_DT
		                   , PI.PRCHS_ID
		                   , CP.DP_CAT_NO
		                   , PE.PROD_ID
		                FROM TBL_OD_PRCHS_INFO     PI
		                   , TBL_OD_EXP_PRCHS_INFO PE
		                   , TBL_DP_PROD           PR
		                   , TBL_DP_CAT_PROD       CP
		               WHERE PI.PRCHS_ID  = PE.PRCHS_ID
		                 AND PE.PROD_ID  = PR.PROD_ID
		                 AND PE.PROD_ID   = CP.PROD_ID
		                 AND PR.PROD_STAT_CD = 'PD000404'  --판매중
		                 AND CP.DP_YN = 'Y'                -- 전시중 
		                 AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
		                 AND PR.PROD_CHRG_CLS = 'N'        -- 'Y':유료,'N':무료
		                 AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
					  <isNotEqual property="dpCatNo" compareValue="DP01">
						 AND  CP.DP_CAT_NO = #dpCatNo#
					  </isNotEqual>
		        )
		        GROUP BY DP_CAT_NO, PROD_ID
		        ORDER BY COUNT(PROD_ID) DESC
		    )A
		  WHERE ROWNUM BETWEEN 1 AND 150
		)
	</statement>
	<statement id="Contents.insertFreeBestDefaultPay2" parameterClass="dpBestParam">
		INSERT INTO 
			/* Contents.insertFreeBestDefaultPay2 swjoo 2011.05.11 : Contents_SqlMap.xml */  
			TBL_DP_FREE_DWLD_BEST
		(
		WK_START_DT,WK_END_DT,DP_CAT_NO,PROD_ID,DWLD_CNT,EXPO_PRIOR,REG_DT,EXPO_YN
		)
		(
			SELECT TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_START_DT
			     , TO_CHAR(SYSDATE-1, 'YYYYMMDD') AS WK_END_DT
			  <isEqual property="dpCatNo" compareValue="DP01">
				 , 'DP01' AS DP_CAT_NO
			  </isEqual>
			  <isNotEqual property="dpCatNo" compareValue="DP01">
				 , A.DP_CAT_NO
			  </isNotEqual>
			     , A.PROD_ID
			     , A.DWLD_CNT
			     , ROWNUM + #payChkCnt# EXPO_PRIOR
			     , TO_CHAR(SYSDATE, 'YYYYMMDD') AS REG_DT
			     , 'Y' AS EXPO_YN
			  FROM
			  (
			      SELECT
			             A.DP_CAT_NO AS DP_CAT_NO,
			             P.PROD_ID   AS PROD_ID,
			             NVL((SELECT DWLD_CNT FROM TBL_DP_PROD_DWLD PW WHERE A.PROD_ID = PW.PROD_ID), 0) AS DWLD_CNT
			        FROM TBL_DP_CAT_PROD A,
			             TBL_DP_PROD P
			       WHERE A.PROD_ID = P.PROD_ID
				  <isNotEqual property="dpCatNo" compareValue="DP01">
					 AND  A.DP_CAT_NO = #dpCatNo#
				  </isNotEqual>
			         AND P.PROD_STAT_CD = 'PD000404'  --판매중
			         AND A.DP_YN = 'Y'                -- 전시중
			         AND P.PROD_CHRG_CLS = 'N'        -- 'Y':유료,'N':무료
			         AND A.PROD_ID NOT IN(
			                              SELECT DISTINCT PE.PROD_ID
			                                FROM TBL_OD_PRCHS_INFO     PI
			                                   , TBL_OD_EXP_PRCHS_INFO PE
			                                   , TBL_DP_PROD           PR
			                                   , TBL_DP_CAT_PROD       CP
			                               WHERE PI.PRCHS_ID  = PE.PRCHS_ID
			                                 AND PE.PROD_ID  = PR.PROD_ID
			                                 AND PE.PROD_ID   = CP.PROD_ID
			                                 AND PR.PROD_STAT_CD = 'PD000404'  --판매중
			                                 AND CP.DP_YN = 'Y'                -- 전시중 
			                                 AND PI.PRCHS_STAT = 'OR000301'    -- 구매완료
			                                 AND PR.PROD_CHRG_CLS = 'N'        -- 'Y':유료,'N':무료
			                                 AND PI.PRCHS_DT = TO_CHAR(SYSDATE-1, 'YYYYMMDD') -- 처리일자
										  <isNotEqual property="dpCatNo" compareValue="DP01">
											 AND  CP.DP_CAT_NO = #dpCatNo#
										  </isNotEqual>
			                              )
			       ORDER BY P.REG_DT DESC, P.REG_TM DESC
			  )A
			WHERE ROWNUM BETWEEN 1 AND #payTotCnt#
		)
	</statement>
	<statement id="Contents.deleteFreeBestDefaultPay" parameterClass="dpBestParam">
		DELETE 
				/* Contents.deleteFreeBestDefaultPay swjoo 2011.05.11 : Contents_SqlMap.xml */
				TBL_DP_FREE_DWLD_BEST
		 WHERE DP_CAT_NO = #dpCatNo#
		   AND REG_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	</statement>
	
</sqlMap>
